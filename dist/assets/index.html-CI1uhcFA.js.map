{"version":3,"file":"index.html-CI1uhcFA.js","sources":["../../src/popup/ui/Popup.tsx","../../src/popup/index.tsx"],"sourcesContent":["/** @format */\n\nimport React, { useEffect, useState } from \"react\";\nimport {\n  DEFAULT_SHEET_NAME,\n  STORAGE_KEYS,\n  type LastSubmission,\n  type StatusState,\n} from \"../../shared/types\";\n\nfunction useChromeStorage<T>(key: string, initial: T) {\n  const [value, setValue] = useState<T>(initial);\n  useEffect(() => {\n    chrome.storage.local.get([key], (r) => {\n      setValue((r as any)[key] ?? initial);\n    });\n  }, [key]);\n  return value;\n}\n\n// Form protection: Check for saved form data\nfunction useFormProtectionStatus() {\n  const [hasSavedForms, setHasSavedForms] = useState(false);\n  const [savedFormsCount, setSavedFormsCount] = useState(0);\n\n  useEffect(() => {\n    const checkSavedForms = () => {\n      try {\n        const keys = Object.keys(localStorage);\n        const formKeys = keys.filter(key => key.startsWith('jt_form_'));\n        setHasSavedForms(formKeys.length > 0);\n        setSavedFormsCount(formKeys.length);\n      } catch (error) {\n        console.warn('Job Tracker: Failed to check saved forms:', error);\n      }\n    };\n\n    checkSavedForms();\n    \n    // Listen for storage changes\n    const handleStorageChange = () => checkSavedForms();\n    window.addEventListener('storage', handleStorageChange);\n    \n    return () => window.removeEventListener('storage', handleStorageChange);\n  }, []);\n\n  const clearAllSavedForms = () => {\n    try {\n      const keys = Object.keys(localStorage);\n      const formKeys = keys.filter(key => key.startsWith('jt_form_'));\n      formKeys.forEach(key => localStorage.removeItem(key));\n      setHasSavedForms(false);\n      setSavedFormsCount(0);\n      console.log('Job Tracker: All saved forms cleared');\n    } catch (error) {\n      console.warn('Job Tracker: Failed to clear saved forms:', error);\n    }\n  };\n\n  return { hasSavedForms, savedFormsCount, clearAllSavedForms };\n}\n\nexport const Popup: React.FC = () => {\n  const lastSubmission = useChromeStorage<\n    LastSubmission | undefined\n  >(STORAGE_KEYS.lastSubmission, undefined);\n  const lastStatus = useChromeStorage<\n    StatusState | undefined\n  >(STORAGE_KEYS.lastStatus, undefined);\n  const { hasSavedForms, savedFormsCount, clearAllSavedForms } = useFormProtectionStatus();\n\n  const [sheetId, setSheetId] = useState<string>(\"\");\n\n  useEffect(() => {\n    chrome.storage.local.get(\n      [STORAGE_KEYS.sheetId],\n      (r) =>\n        setSheetId(\n          (r as any)[STORAGE_KEYS.sheetId] || \"\"\n        )\n    );\n  }, []);\n\n  async function connect() {\n    const resp = await chrome.runtime.sendMessage({\n      type: \"JT_AUTHORIZE\",\n    });\n    if (!resp?.ok)\n      alert(resp?.error || \"Authorization failed\");\n    else alert(\"Connected to Google\");\n  }\n\n  function openSheet() {\n    if (!sheetId) {\n      alert(\"Set your Google Sheet in Options\");\n      return;\n    }\n    const url = `https://docs.google.com/spreadsheets/d/${encodeURIComponent(\n      sheetId\n    )}`;\n    window.open(url, \"_blank\");\n  }\n\n  return (\n    <div className=\"min-w-[280px] p-3 text-slate-900\">\n      <div className=\"text-base font-bold mb-2\">\n        Job Tracker\n      </div>\n      \n      {/* Form Protection Status */}\n      {hasSavedForms && (\n        <div className=\"mb-3 p-2 bg-yellow-50 border border-yellow-200 rounded-lg\">\n          <div className=\"text-xs text-yellow-800 mb-1\">\n            ⚠️ {savedFormsCount} form{savedFormsCount > 1 ? 's' : ''} with unsaved data\n          </div>\n          <button\n            onClick={clearAllSavedForms}\n            className=\"text-xs text-yellow-700 underline hover:text-yellow-900\"\n          >\n            Clear all saved forms\n          </button>\n        </div>\n      )}\n      \n      {lastStatus && (\n        <div\n          className={`text-xs mb-2 ${\n            lastStatus.ok\n              ? \"text-green-600\"\n              : \"text-red-600\"\n          }`}\n        >\n          {lastStatus.message}\n        </div>\n      )}\n      \n      <div className=\"border rounded-xl p-3 shadow-sm\">\n        <div className=\"text-xs text-slate-500 mb-2\">\n          Last submission\n        </div>\n        <div>\n          <div>\n            <span className=\"text-slate-500\">\n              Company:\n            </span>{\" \"}\n            {lastSubmission?.company || \"—\"}\n          </div>\n          <div>\n            <span className=\"text-slate-500\">\n              Title:\n            </span>{\" \"}\n            {lastSubmission?.title || \"—\"}\n          </div>\n          <div>\n            <span className=\"text-slate-500\">\n              Date:\n            </span>{\" \"}\n            {lastSubmission?.date || \"—\"}\n          </div>\n        </div>\n      </div>\n      \n      <div className=\"flex items-center gap-2 mt-3\">\n        <button\n          className=\"px-3 py-2 rounded-lg bg-blue-600 text-white\"\n          onClick={openSheet}\n        >\n          Open Sheet\n        </button>\n        <button\n          className=\"px-3 py-2 rounded-lg border\"\n          onClick={connect}\n        >\n          Connect\n        </button>\n        <button\n          className=\"text-xs text-slate-500 underline\"\n          onClick={() => {\n            if (chrome.runtime.openOptionsPage) {\n              chrome.runtime.openOptionsPage();\n            } else {\n              window.open(\"/src/options/index.html\", \"_blank\");\n            }\n          }}\n        >\n          Options\n        </button>\n      </div>\n      \n      {/* Form Protection Info */}\n      <div className=\"mt-3 text-xs text-slate-500\">\n        <div>✓ Auto-save every 3 seconds</div>\n        <div>✓ Warn before leaving with changes</div>\n        <div>✓ Restore data on page reload</div>\n      </div>\n    </div>\n  );\n};\n","/** @format */\n\nimport React from \"react\";\nimport { createRoot } from \"react-dom/client\";\nimport { Popup } from \"./ui/Popup\";\nimport \"../styles/tailwind.css\";\n\nconst container = document.getElementById(\"root\")!;\nconst root = createRoot(container);\nroot.render(<Popup />);\n"],"names":["useChromeStorage","key","initial","value","setValue","useState","useEffect","r","useFormProtectionStatus","hasSavedForms","setHasSavedForms","savedFormsCount","setSavedFormsCount","checkSavedForms","formKeys","error","handleStorageChange","Popup","lastSubmission","STORAGE_KEYS","lastStatus","clearAllSavedForms","sheetId","setSheetId","connect","resp","openSheet","url","jsxs","jsx","container","root","createRoot"],"mappings":"iGAUA,SAASA,EAAoBC,EAAaC,EAAY,CACpD,KAAM,CAACC,EAAOC,CAAQ,EAAIC,EAAAA,SAAYH,CAAO,EAC7CI,OAAAA,EAAAA,UAAU,IAAM,CACd,OAAO,QAAQ,MAAM,IAAI,CAACL,CAAG,EAAIM,GAAM,CACrCH,EAAUG,EAAUN,CAAG,GAAKC,CAAO,CACrC,CAAC,CACH,EAAG,CAACD,CAAG,CAAC,EACDE,CACT,CAGA,SAASK,GAA0B,CACjC,KAAM,CAACC,EAAeC,CAAgB,EAAIL,EAAAA,SAAS,EAAK,EAClD,CAACM,EAAiBC,CAAkB,EAAIP,EAAAA,SAAS,CAAC,EAExDC,OAAAA,EAAAA,UAAU,IAAM,CACd,MAAMO,EAAkB,IAAM,CAC5B,GAAI,CAEF,MAAMC,EADO,OAAO,KAAK,YAAY,EACf,UAAcb,EAAI,WAAW,UAAU,CAAC,EAC9DS,EAAiBI,EAAS,OAAS,CAAC,EACpCF,EAAmBE,EAAS,MAAM,CACpC,OAASC,EAAO,CACd,QAAQ,KAAK,4CAA6CA,CAAK,CACjE,CACF,EAEAF,EAAA,EAGA,MAAMG,EAAsB,IAAMH,EAAA,EAClC,cAAO,iBAAiB,UAAWG,CAAmB,EAE/C,IAAM,OAAO,oBAAoB,UAAWA,CAAmB,CACxE,EAAG,CAAA,CAAE,EAeE,CAAE,cAAAP,EAAe,gBAAAE,EAAiB,mBAbd,IAAM,CAC/B,GAAI,CACW,OAAO,KAAK,YAAY,EACf,UAAcV,EAAI,WAAW,UAAU,CAAC,EACrD,QAAQA,GAAO,aAAa,WAAWA,CAAG,CAAC,EACpDS,EAAiB,EAAK,EACtBE,EAAmB,CAAC,EACpB,QAAQ,IAAI,sCAAsC,CACpD,OAASG,EAAO,CACd,QAAQ,KAAK,4CAA6CA,CAAK,CACjE,CACF,CAEyC,CAC3C,CAEO,MAAME,EAAkB,IAAM,CACnC,MAAMC,EAAiBlB,EAErBmB,EAAa,eAAgB,MAAS,EAClCC,EAAapB,EAEjBmB,EAAa,WAAY,MAAS,EAC9B,CAAE,cAAAV,EAAe,gBAAAE,EAAiB,mBAAAU,CAAA,EAAuBb,EAAA,EAEzD,CAACc,EAASC,CAAU,EAAIlB,EAAAA,SAAiB,EAAE,EAEjDC,EAAAA,UAAU,IAAM,CACd,OAAO,QAAQ,MAAM,IACnB,CAACa,EAAa,OAAO,EACpBZ,GACCgB,EACGhB,EAAUY,EAAa,OAAO,GAAK,EAAA,CACtC,CAEN,EAAG,CAAA,CAAE,EAEL,eAAeK,GAAU,CACvB,MAAMC,EAAO,MAAM,OAAO,QAAQ,YAAY,CAC5C,KAAM,cAAA,CACP,EACIA,GAAA,MAAAA,EAAM,SAEA,qBAAqB,EAD9B,OAAMA,GAAA,YAAAA,EAAM,QAAS,sBAAsB,CAE/C,CAEA,SAASC,GAAY,CACnB,GAAI,CAACJ,EAAS,CACZ,MAAM,kCAAkC,EACxC,MACF,CACA,MAAMK,EAAM,0CAA0C,mBACpDL,CAAA,CACD,GACD,OAAO,KAAKK,EAAK,QAAQ,CAC3B,CAEA,OACEC,EAAAA,KAAC,MAAA,CAAI,UAAU,mCACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,2BAA2B,SAAA,cAE1C,EAGCpB,GACCmB,EAAAA,KAAC,MAAA,CAAI,UAAU,4DACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,+BAA+B,SAAA,CAAA,MACxCjB,EAAgB,QAAMA,EAAkB,EAAI,IAAM,GAAG,oBAAA,EAC3D,EACAkB,EAAAA,IAAC,SAAA,CACC,QAASR,EACT,UAAU,0DACX,SAAA,uBAAA,CAAA,CAED,EACF,EAGDD,GACCS,EAAAA,IAAC,MAAA,CACC,UAAW,gBACTT,EAAW,GACP,iBACA,cACN,GAEC,SAAAA,EAAW,OAAA,CAAA,EAIhBQ,EAAAA,KAAC,MAAA,CAAI,UAAU,kCACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,8BAA8B,SAAA,kBAE7C,SACC,MAAA,CACC,SAAA,CAAAD,OAAC,MAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,OAAA,CAAK,UAAU,iBAAiB,SAAA,WAEjC,EAAQ,KACPX,GAAA,YAAAA,EAAgB,UAAW,GAAA,EAC9B,SACC,MAAA,CACC,SAAA,CAAAW,EAAAA,IAAC,OAAA,CAAK,UAAU,iBAAiB,SAAA,SAEjC,EAAQ,KACPX,GAAA,YAAAA,EAAgB,QAAS,GAAA,EAC5B,SACC,MAAA,CACC,SAAA,CAAAW,EAAAA,IAAC,OAAA,CAAK,UAAU,iBAAiB,SAAA,QAEjC,EAAQ,KACPX,GAAA,YAAAA,EAAgB,OAAQ,GAAA,CAAA,CAC3B,CAAA,CAAA,CACF,CAAA,EACF,EAEAU,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CACC,UAAU,8CACV,QAASH,EACV,SAAA,YAAA,CAAA,EAGDG,EAAAA,IAAC,SAAA,CACC,UAAU,8BACV,QAASL,EACV,SAAA,SAAA,CAAA,EAGDK,EAAAA,IAAC,SAAA,CACC,UAAU,mCACV,QAAS,IAAM,CACT,OAAO,QAAQ,gBACjB,OAAO,QAAQ,gBAAA,EAEf,OAAO,KAAK,0BAA2B,QAAQ,CAEnD,EACD,SAAA,SAAA,CAAA,CAED,EACF,EAGAD,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAC,EAAAA,IAAC,OAAI,SAAA,6BAAA,CAA2B,EAChCA,EAAAA,IAAC,OAAI,SAAA,oCAAA,CAAkC,EACvCA,EAAAA,IAAC,OAAI,SAAA,+BAAA,CAA6B,CAAA,CAAA,CACpC,CAAA,EACF,CAEJ,EC9LMC,EAAY,SAAS,eAAe,MAAM,EAC1CC,EAAOC,EAAWF,CAAS,EACjCC,EAAK,OAAOF,EAAAA,IAACZ,EAAA,CAAA,CAAM,CAAE"}